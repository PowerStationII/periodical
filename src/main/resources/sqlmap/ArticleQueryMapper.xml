<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ArticleQueryMapper">
	<resultMap id="ArticleInfosForEditorResultMap" type="ArticleQueryRespDto">
		<result column="articleId" jdbcType="VARCHAR" property="articleId" />
		<result column="title" jdbcType="VARCHAR" property="title" />
		<result column="contriTime" jdbcType="VARCHAR" property="contriTime" />
		<result column="authorName" jdbcType="VARCHAR" property="authorName" />
		<result column="editorState" jdbcType="VARCHAR" property="editorState" />
		<result column="expertState" jdbcType="VARCHAR" property="expertState" />
		<result column="section" jdbcType="VARCHAR" property="section" />
	</resultMap>

	<select id="selectArticleInfosForEditor" parameterType="ArticleQueryReqDto"
		resultMap="ArticleInfosForEditorResultMap">
		select ai.article_id as articleId,ai.article_cn_title as
		title,DATE_FORMAT(ai.create_time, '%Y-%m-%d') as
		contriTime,group_concat(aui.author_name) as authorName,
		ai.editor_state as editorState,ai.expert_state as
		expertState,ai.invest_section as section
		from
		article_info
		ai,article_info_extend aie,author_info aui
		where
		ai.article_id=aie.article_id and ai.article_id=aui.article_id
		<if test="userId != null and ''!=userId">
			and aie.user_id = #{userId,jdbcType=VARCHAR}
		</if>
		<if test="editorState != null and ''!=editorState">
			and ai.editor_state = #{editorState,jdbcType=VARCHAR}
		</if>
		<if test="expertState != null and ''!=expertState">
			and ai.expert_state = #{expertState,jdbcType=VARCHAR}
		</if>
		<if test="articleId != null and ''!=articleId">
			and ai.article_id = #{articleId,jdbcType=VARCHAR}
		</if>
		<if test="articleCnTitle != null and ''!=articleCnTitle">
			and ai.article_cn_title =
			#{articleCnTitle,jdbcType=VARCHAR}
		</if>
		<if test="section != null and ''!=section">
			and ai.invest_section = #{section,jdbcType=VARCHAR}
		</if>
		<if test="creatTime != null and ''!=creatTime">
			and DATE_FORMAT(ai.create_time, '%Y-%m-%d') =
			#{creatTime,jdbcType=VARCHAR}
		</if>
		<if test="authorName != null and ''!=authorName">
			and #{authorName,jdbcType=VARCHAR} in (select
			group_concat(aui.author_name))
		</if>
		group by
		ai.article_id,ai.article_cn_title,DATE_FORMAT(ai.create_time,'%Y-%m-%d'),ai.editor_state,ai.expert_state,ai.invest_section
	</select>

	<resultMap id="ArticleInfoDetailResultMap" type="ArticleQueryRespDto">
		<result column="articleId" jdbcType="VARCHAR" property="articleId" />
		<result column="title" jdbcType="VARCHAR" property="title" />
		<result column="editorState" jdbcType="VARCHAR" property="editorState" />
		<result column="expertState" jdbcType="VARCHAR" property="expertState" />
		<result column="authorState" jdbcType="VARCHAR" property="authorState" />
		<result column="enTitle" jdbcType="VARCHAR" property="enTitle" />
		<result column="fNums" jdbcType="VARCHAR" property="fNums" />
		<result column="section" jdbcType="VARCHAR" property="section" />
		<result column="cnKeywords" jdbcType="VARCHAR" property="cnKeywords" />
		<result column="enKeywords" jdbcType="VARCHAR" property="enKeywords" />
		<result column="cnSummary" jdbcType="VARCHAR" property="cnSummary" />
		<result column="enSummary" jdbcType="VARCHAR" property="enSummary" />
		<result column="attachName" jdbcType="VARCHAR" property="attachName" />
		<result column="attachPath" jdbcType="VARCHAR" property="attachPath" />
		<result column="authorName" jdbcType="VARCHAR" property="authorName" />
	</resultMap>
	<select id="selectArticleInfoDetail" parameterType="ArticleQueryReqDto"
		resultMap="ArticleInfoDetailResultMap">
		select ai.article_id as articleId,ai.article_cn_title as title,
		ai.editor_state as editorState,ai.expert_state as
		expertState,ai.author_state as authorState,
		ai.article_en_tile as
		enTitle,ai.classification_nums as fNums,
		ai.invest_section as
		section,ai.article_cn_keywords as cnKeywords,
		ai.article_en_keywords as
		enKeywords,ai.article_cn_summary as
		cnSummary,
		ai.article_en_summary as
		enSummary,aai.attachment_name as attachName,
		aai.attachment_path as
		attachPath,group_concat(aui.author_name) as authorName
		from
		article_info ai,article_info_extend aie,article_attachment_info
		aai,author_info aui
		where ai.article_id=aie.article_id and
		ai.article_id=aai.article_id and aui.article_id=ai.article_id
		and
		aai.type=#{roleId,jdbcType=VARCHAR}
		and
		ai.article_id=#{articleId,jdbcType=VARCHAR}
		<if test="editorState != null">
			and ai.editor_state = #{editorState,jdbcType=VARCHAR}
		</if>
		<if test="expertState != null">
			and ai.expert_state = #{expertState,jdbcType=VARCHAR}
		</if>
		<if test="authorState != null">
			and ai.author_state = #{authorState,jdbcType=VARCHAR}
		</if>
		<if test="userId != null">
			and aie.user_id = #{userId,jdbcType=VARCHAR}
		</if>
		group by ai.article_id ,ai.article_cn_title ,
		ai.article_en_tile
		,ai.classification_nums,
		ai.invest_section ,ai.article_cn_keywords ,
		ai.article_en_keywords ,ai.article_cn_summary ,
		ai.article_en_summary
		,aai.attachment_name,
		aai.attachment_path,ai.expert_state,ai.editor_state,ai.author_state
	</select>


	<resultMap type="AuthorQueryDetail" id="AuthorQueryDetailResult">
		<result column="articleId" jdbcType="VARCHAR" property="articleId" />
		<result column="authorState" jdbcType="VARCHAR" property="authorState" />
		<result column="articleCnTitle" jdbcType="VARCHAR" property="articleCnTitle" />
		<result column="articleEnTile" jdbcType="VARCHAR" property="articleEnTile" />
		<result column="articleCnKeywords" jdbcType="VARCHAR" property="articleCnKeywords" />
		<result column="articleEnKeywords" jdbcType="VARCHAR" property="articleEnKeywords" />
		<result column="articleCnSummary" jdbcType="VARCHAR" property="articleCnSummary" />
		<result column="articleEnSummary" jdbcType="VARCHAR" property="articleEnSummary" />
		<result column="attachmentName" jdbcType="VARCHAR" property="attachmentName" />
		<result column="attachmentPath" jdbcType="VARCHAR" property="attachmentPath" />
		<result column="refId" jdbcType="VARCHAR" property="refId" />
		<result column="dealStartTime" jdbcType="VARCHAR" property="dealStartTime" />
		<result column="expertName" jdbcType="VARCHAR" property="expertName" />
		<result column="cNums" jdbcType="VARCHAR" property="cNums" />
		<result column="section" jdbcType="VARCHAR" property="section" />
	</resultMap>
	<select id="authorQueryDetail" resultMap="AuthorQueryDetailResult"
		parameterType="String">
		select
		ai.article_id as articleId,ai.author_state as
		authorState,ai.article_cn_title as articleCnTitle,
		ai.article_en_tile
		as articleEnTile,ai.classification_nums as classificationNums,
		ai.article_cn_keywords as articleCnKeywords,ai.article_en_keywords as
		articleEnKeywords,
		ai.article_cn_summary as
		articleCnSummary,ai.invest_section as section,ai.classification_nums
		as cNums,
		ai.article_en_summary as articleEnSummary,aai.attachment_name
		as attachmentName,aai.attachment_path as attachmentPath,
		af.ref_id as
		refId,DATE_FORMAT(af.deal_start_time, '%Y-%m-%d') as
		dealStartTime,ei.expert_name as expertName
		from article_info ai,article_attachment_info aai,article_flows
		af,expert_info ei,user_info ui
		where af.ref_id=ui.user_id and
		ui.ref_id=ei.expert_id and
		ai.article_id=aai.article_id and
		ai.article_id=#{articleId,jdbcType=VARCHAR} and aai.type='1006'
		and
		af.article_id=ai.article_id and af.role_id='1003'
	</select>

	<select id="articleFeeQuery" resultMap="AuthorQueryDetailResult" parameterType="AuthorQueryDetail">
		select aci.author_real_amount as
		aRealAmount,aci.author_amount as aAmount,aci.author_tax_amount as
		aTaxAmount,ai.article_id as articleId,ai.author_state as
		authorState,ai.article_cn_title as articleCnTitle,
		ai.article_en_tile as articleEnTile,ai.classification_nums as classificationNums,
		ai.article_cn_keywords as articleCnKeywords,ai.article_en_keywords as
		articleEnKeywords,
		ai.article_cn_summary as articleCnSummary,ai.invest_section as
		section,ai.classification_nums as cNums,
		ai.article_en_summary as articleEnSummary
		from account_info aci,article_info ai,article_info_extend aie
		where aci.article_id=ai.article_id and ai.article_id=aie.article_id
		and aie.user_id=#{userId,jdbcType=VARCHAR}
		<if test="articleId != null">
			and ai.article_id = #{articleId,jdbcType=VARCHAR}
		</if>
	</select>

</mapper>